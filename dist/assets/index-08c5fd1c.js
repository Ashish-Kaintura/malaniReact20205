import{r as t,j as P}from"./index-de4dc652.js";import{M as S,i as W,u as I,P as b,a as D,b as H,L as K}from"./proxy-1fd76a63.js";class U extends t.Component{getSnapshotBeforeUpdate(l){const e=this.props.childRef.current;if(e&&l.isPresent&&!this.props.isPresent){const c=e.offsetParent,m=W(c)&&c.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=m-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function X({children:i,isPresent:l,anchorX:e,root:c}){const m=t.useId(),n=t.useRef(null),p=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:g}=t.useContext(S);return t.useInsertionEffect(()=>{const{width:y,height:s,top:C,left:r,right:u}=p.current;if(l||!n.current||!y||!s)return;const d=e==="left"?`left: ${r}`:`right: ${u}`;n.current.dataset.motionPopId=m;const f=document.createElement("style");g&&(f.nonce=g);const a=c??document.head;return a.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${s}px !important;
            ${d}px !important;
            top: ${C}px !important;
          }
        `),()=>{a.contains(f)&&a.removeChild(f)}},[l]),P.jsx(U,{isPresent:l,childRef:n,sizeRef:p,children:t.cloneElement(i,{ref:n})})}const B=({children:i,initial:l,isPresent:e,onExitComplete:c,custom:m,presenceAffectsLayout:n,mode:p,anchorX:g,root:y})=>{const s=I(F),C=t.useId();let r=!0,u=t.useMemo(()=>(r=!1,{id:C,initial:l,isPresent:e,custom:m,onExitComplete:d=>{s.set(d,!0);for(const f of s.values())if(!f)return;c&&c()},register:d=>(s.set(d,!1),()=>s.delete(d))}),[e,s,c]);return n&&r&&(u={...u}),t.useMemo(()=>{s.forEach((d,f)=>s.set(f,!1))},[e]),t.useEffect(()=>{!e&&!s.size&&c&&c()},[e]),p==="popLayout"&&(i=P.jsx(X,{isPresent:e,anchorX:g,root:y,children:i})),P.jsx(b.Provider,{value:u,children:i})};function F(){return new Map}const R=i=>i.key||"";function z(i){const l=[];return t.Children.forEach(i,e=>{t.isValidElement(e)&&l.push(e)}),l}const V=({children:i,custom:l,initial:e=!0,onExitComplete:c,presenceAffectsLayout:m=!0,mode:n="sync",propagate:p=!1,anchorX:g="left",root:y})=>{const[s,C]=D(p),r=t.useMemo(()=>z(i),[i]),u=p&&!s?[]:r.map(R),d=t.useRef(!0),f=t.useRef(r),a=I(()=>new Map),[k,v]=t.useState(r),[x,L]=t.useState(r);H(()=>{d.current=!1,f.current=r;for(let h=0;h<x.length;h++){const o=R(x[h]);u.includes(o)?a.delete(o):a.get(o)!==!0&&a.set(o,!1)}},[x,u.length,u.join("-")]);const M=[];if(r!==k){let h=[...r];for(let o=0;o<x.length;o++){const E=x[o],j=R(E);u.includes(j)||(h.splice(o,0,E),M.push(E))}return n==="wait"&&M.length&&(h=M),L(z(h)),v(r),null}const{forceRender:w}=t.useContext(K);return P.jsx(P.Fragment,{children:x.map(h=>{const o=R(h),E=p&&!s?!1:r===x||u.includes(o),j=()=>{if(a.has(o))a.set(o,!0);else return;let $=!0;a.forEach(A=>{A||($=!1)}),$&&(w==null||w(),L(f.current),p&&(C==null||C()),c&&c())};return P.jsx(B,{isPresent:E,initial:!d.current||e?void 0:!1,custom:l,presenceAffectsLayout:m,mode:n,root:y,onExitComplete:E?void 0:j,anchorX:g,children:h},o)})})};export{V as A};
